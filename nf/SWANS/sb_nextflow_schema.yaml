app_content:
    code_package: 68adec0613c54b4dd0aba1db
    entrypoint: main.nf
class: nextflow
executor_version: 23.04.1
cwlVersion: None
doc: | 
    # SWANS 2.0: Single-entity Workflow ANalysiS Pipeline
    Citation: https://doi.org/10.1101/2025.05.14.654073.
    This is a NextFlow implementation of the [SWANS (Single-entity Workflow ANalysiS Pipeline)](https://github.com/FrancoResearchLab/SWANS) for Single Cell RNAseq Analysis.
    It is in alpha phase, but testing on two samples using a 8 core, 64GB EC2 was successful, as well as on CAVATICA. The [test json](nf/test_inputs/test.json) has a bare bones example starting with cell ranger matrices using all defaults in the nextflow.config.
    It can handle a mix of doubleFinder, SoupX, and CellRanger inputs, passing the inputs to the appropriate steps, and merging before initial seurat object step.
    However, mixed mode has not been tested yet, and FLEX input support is still forthcoming. 
    After running the workflow, refer to https://github.com/FrancoResearchLab/SWANS/tree/main?tab=readme-ov-file#html--shiny-report on how to use the interactive report.

    ## INPUTS
    ### Required:
    - `sample_condition_map_file`: tsv with input sample, condition, remap. Last column value can be blank if original sample name to be used. Original sample name should match what is part of the directory path name
    - `project`: string for project name
    ### Required, mutually exclusive
    Parameters in which one or both must be provided, but both cannot be blank
    #### Input data from _directories_, if applicable
    - `input_dir_list`: Input data from one or more of doubletFinder, soupX, cell ranger in directories
    - `input_dir_src_list`: Source of input dirs, options: doubletFinder, soupX, cellranger
    #### Input data from _tar balls_, if applicable
    - `input_dir_list`: Input data from one or more of doubletFinder, soupX, cell ranger in tar balls
    - `input_dir_src_list`: Source of input tar balls, options: doubletFinder, soupX, cellranger
    Must have one of, or both a `directories` or `tar balls` input
    ### Required with defaults:
    - `organism`: `human`. Other optinon is `mouse`
    - `disable_doubletfinder`: `false`. Flag to skip running doubletFinder
    - `mito_cutoff`:  `15`. mitchondrial cutoff threshold, percent as int
    - `ribo_cutoff`: `100`. ribosomal cutoff threshold, percent as int
    - `min_feature_threshold`: `200`
    - `max_feature_threshold`: `3000`
    - `int_components`: `30`. number of Principal Components to use in Seurat
    - `dbl_mem`: `30`. default ram in GB for doubletFinder jobs
    - `dbl_threads`: `2`. default threads for doubletFinder jobs
    - `disable_soupx`: `false`. Set to `true` to skip SoupX.
    - `soupx_start`: `outs`
    - `outs`: Cell ranger outputs thave have clustering information
    - `no_clusters`: Have clusters calculated
    - `h5`: Input matrix is in h5 format
    - `aso_processes`: `4`. Number of processes for Seurat analysis.
    - `aso_memory`: `30000000000` (30 GB). Memory allocation for Seurat analysis in bytes.
    - `run_azimuth`: `"n"`. Set to `"y"` to enable Azimuth reference mapping.
    - `run_transferdata`: `"n"`. Set to `"y"` to enable TransferData.
    - `mito_regression`: `"n"`. Set to `"y"` to enable mitochondrial regression.
    - `ribo_regression`: `"n"`. Set to `"y"` to enable ribosomal regression.
    - `cc_regression`: `"n"`. Set to `"y"` to enable cell cycle regression.
    - `num_var_features`: `3000`. Number of variable features.
    - `resolution_config`: `"0.1,0.2,0.3"`. Comma-separated clustering resolutions.
    - `include_tsne`: `"n"`. Set to `"y"` to include t-SNE.
    - `scale_data_features`: `"variable"`. Options:
    - `all`
    - `variable`
    - `split_layers_by`: `"Sample"`. Metadata column to split layers. Options:
    - `Sample`
    - `Experiment`
    - `normalization_config`: `"standard,sct"`. Comma-separated normalization methods. One or more of:
    - `sct`
    - `standard`
    - `integration_config`: `"cca,rpca,harmony"`. Comma-separated integration methods. On or more of:
    - `cca`
    - `rpca`
    - `harmony`
    - `ref_based_integration`: `"n"`. Set to `"y"` for reference-based integration.
    - `storage`: `rds`. Output format.
    - `conserved_genes`: `"n"`. Set to `"y"` to include conserved genes.
    - `visualization`: `dot`. Visualization type. One or more of:
    - `feature`
    - `violin`
    - `ridge`
    - `dot`
    ### Optional when "parent" params is `y`
    - `run_transferdata`
    - `transferdata_ref_file`: path to reference Seurat object for TransferData
    - `transferdata_reduction`: which dimensional reduction in the TRANSFERDATA REF FILE to use for TransferData
    - `transferdata_annocol`: which Seurat meta.data column to use for TransferData annotation
    - `run_azimuth`
    - `azimuth_ref`: Reference preset for Azimuth Choices: 
        - `adiposeref`
        - `bonemarrowref`
        - `fetusref`
        - `heartref`
        - `humancortexref`
        - `kidneyref`
        - `lungref`
        - `pancreasref`
        - `pbmcref`
        - `tonsilref`
    - `cc_regression`
    - `cc_method`: `standard`, `alternative`
    - `ref_based_integration`
    - `ref_samples`: Reference samples for integration.
    - `regression_file`: Path to regression file.

    Refer to the [Nextflow documentation](https://www.nextflow.io/docs/latest/) for advanced usage and profiles.

    ## OUTPUTS
    - Analysis results tar ball. See https://github.com/FrancoResearchLab/SWANS?tab=readme-ov-file#output-structure
    - Tar ball outputs of doubleFinder and SoupX if flag enabled

requirements:
-   class: InlineJavascriptRequirement
-   class: ShellCommandRequirement
-   class: InitialWorkDirRequirement
    listing:
    - entryname: input_params.json
      entry: |
          $(JSON.stringify(
          {
          input_dir_src_list: inputs.input_dir_src_list ? inputs.input_dir_src_list : "",
          input_tar_src_list: inputs.input_tar_src_list ? inputs.input_tar_src_list : ""
          }
          ))
-   class: LoadListingRequirement
    loadListing: deep_listing

hints:
-   class: sbg:NextflowExecutionMode
    value: multi-instance
-   class: "sbg:maxNumberOfParallelInstances"
    value: 10
arguments:
-   position: 0
    shellQuote: false
    valueFrom: >
        -params-file input_params.json
inputs:
-   id: r_lib_path
    inputBinding:
        prefix: --r_lib_path
    default: /usr/local/lib/R/site-library/
    type:
    - 'null'
    - string
-   id: input_dir_list
    type: 'Directory[]?'
    inputBinding:
        shellQuote: false
        itemSeparator: ','
        prefix: --input_dir_list
-   id: input_dir_src_list
    type: 'string[]?'
-   id: input_tar_list
    type: 'File[]?'
    inputBinding:
        shellQuote: false
        itemSeparator: ','
        prefix: --input_tar_list
-   id: input_tar_src_list
    type: 'string[]?'
-   id: sample_condition_map_file
    inputBinding:
        prefix: --sample_condition_map_file
    type: File
-   id: project
    inputBinding:
        prefix: --project
    type:
    - string
-   id: organism
    inputBinding:
        prefix: --organism
    default: human
    type:
    - 'null'
    - string
-   id: disable_doubletfinder
    inputBinding:
        prefix: --disable_doubletfinder
    type:
    - 'null'
    - boolean
    default: false
-   id: mito_cutoff
    inputBinding:
        prefix: --mito_cutoff
    default: 15
    type:
    - 'null'
    - int
-   id: ribo_cutoff
    inputBinding:
        prefix: --ribo_cutoff
    default: 100
    type:
    - 'null'
    - int
-   id: min_feature_threshold
    inputBinding:
        prefix: --min_feature_threshold
    default: 200
    type:
    - 'null'
    - int
-   id: max_feature_threshold
    inputBinding:
        prefix: --max_feature_threshold
    default: 3000
    type:
    - 'null'
    - int
-   id: int_components
    inputBinding:
        prefix: --int_components
    default: 30
    type:
    - 'null'
    - int
-   id: dbl_mem
    inputBinding:
        prefix: --dbl_mem
    default: 30
    type:
    - 'null'
    - int
-   id: dbl_threads
    inputBinding:
        prefix: --dbl_threads
    default: 2
    type:
    - 'null'
    - int
-   id: disable_soupx
    inputBinding:
        prefix: --disable_soupx
    type:
    - 'null'
    - boolean
    default: false
-   id: soupx_start
    inputBinding:
        prefix: --soupx_start
    type:
    - 'null'
    - string
-   id: aso_processes
    inputBinding:
        prefix: --aso_processes
    default: 4
    type:
    - 'null'
    - int
-   id: aso_memory
    inputBinding:
        prefix: --aso_memory
    default: 30000000000
    type:
    - 'null'
    - int
-   id: run_azimuth
    inputBinding:
        prefix: --run_azimuth
    default: n
    type:
    - 'null'
    - string
-   id: azimuth_ref
    inputBinding:
        prefix: --azimuth_ref
    type:
    - 'null'
    - string
-   id: run_transferdata
    inputBinding:
        prefix: --run_transferdata
    default: n
    type:
    - 'null'
    - string
-   id: transferdata_ref_file
    inputBinding:
        prefix: --transferdata_ref_file
    type:
    - 'null'
    - File
-   id: transferdata_reduction
    inputBinding:
        prefix: --transferdata_reduction
    type:
    - 'null'
    - string
-   id: transferdata_annocol
    inputBinding:
        prefix: --transferdata_annocol
    type:
    - 'null'
    - string
-   id: mito_regression
    inputBinding:
        prefix: --mito_regression
    default: n
    type:
    - 'null'
    - string
-   id: ribo_regression
    inputBinding:
        prefix: --ribo_regression
    default: n
    type:
    - 'null'
    - string
-   id: cc_regression
    inputBinding:
        prefix: --cc_regression
    default: n
    type:
    - 'null'
    - string
-   id: cc_method
    inputBinding:
        prefix: --cc_method
    default: standard
    type:
    - 'null'
    - string
-   id: num_var_features
    inputBinding:
        prefix: --num_var_features
    default: 3000
    type:
    - 'null'
    - int
-   id: resolution_config
    inputBinding:
        prefix: --resolution_config
    default: 0.1,0.2,0.3
    type:
    - 'null'
    - string
-   id: include_tsne
    inputBinding:
        prefix: --include_tsne
    default: n
    type:
    - 'null'
    - string
-   id: scale_data_features
    inputBinding:
        prefix: --scale_data_features
    default: variable
    type:
    - 'null'
    - string
-   id: split_layers_by
    inputBinding:
        prefix: --split_layers_by
    default: Sample
    type:
    - 'null'
    - string
-   id: normalization_config
    inputBinding:
        prefix: --normalization_config
    default: standard,sct
    type:
    - 'null'
    - string
-   id: integration_config
    inputBinding:
        prefix: --integration_config
    default: cca,rpca,harmony
    type:
    - 'null'
    - string
-   id: ref_based_integration
    inputBinding:
        prefix: --ref_based_integration
    default: n
    type:
    - 'null'
    - string
-   id: ref_samples
    inputBinding:
        prefix: --ref_samples
    type:
    - 'null'
    - string
-   id: regression_file
    inputBinding:
        prefix: --regression_file
    type:
    - 'null'
    - File
-   id: storage
    inputBinding:
        prefix: --storage
    default: rds
    type:
    - 'null'
    - string
-   id: conserved_genes
    inputBinding:
        prefix: --conserved_genes
    default: n
    type:
    - 'null'
    - string
-   id: visualization
    inputBinding:
        prefix: --visualization
    default: dot
    type:
    - 'null'
    - string
-   id: user_gene_file
    inputBinding:
        prefix: --user_gene_file
    type:
    - 'null'
    - File
-   id: sbg_run
    inputBinding:
        prefix: --sbg_run
    type:
    - 'null'
    - boolean
    default: true
-   id: outdir
    inputBinding:
        prefix: --outdir
    label: Path to the output directory where the results will be saved.
    sbg:category: Input/output options
    sbg:icon: fas fa-folder-open
    default: ./results
    type: 'string?'
-   doc: Use to set an upper-limit for the CPU requirement for each process. Should
        be an integer e.g. `--max_cpus 1`
    id: max_cpus
    inputBinding:
        prefix: --max_cpus
    label: Maximum number of CPUs that can be requested for any single job.
    sbg:category: Max job request options
    sbg:hidden: true
    sbg:icon: fas fa-microchip
    default: 16
    type:
    - 'null'
    - int
-   doc: Use to set an upper-limit for the memory requirement for each process. Should
        be a string in the format integer-unit e.g. `--max_memory '8.GB'`
    id: max_memory
    inputBinding:
        prefix: --max_memory
    label: Maximum amount of memory that can be requested for any single job.
    sbg:category: Max job request options
    sbg:hidden: true
    sbg:icon: fas fa-memory
    sbg:pattern: ^\d+(\.\d+)?\.?\s*(K|M|G|T)?B$
    default: 128.GB
    type:
    - 'null'
    - string
-   doc: Use to set an upper-limit for the time requirement for each process. Should
        be a string in the format integer-unit e.g. `--max_time '2.h'`
    id: max_time
    inputBinding:
        prefix: --max_time
    label: Maximum amount of time that can be requested for any single job.
    sbg:category: Max job request options
    sbg:hidden: true
    sbg:icon: far fa-clock
    sbg:pattern: ^(\d+\.?\s*(s|m|h|day)\s*)+$
    default: 240.h
    type:
    - 'null'
    - string
label: SWANS Preliminary Analysis
outputs:
-   doc: This is a template output. You can modify the glob pattern to make outputs
        more specific.
    id: nf_publishdir
    label: Publish Directory
    outputBinding:
        glob: '*'
    type:
    - Directory

sbg:revisionNotes: Uploaded using sbpack v2024.12.17
