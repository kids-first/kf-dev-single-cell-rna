process {
    withName: DOUBLETFINDER {
        publishDir = [
            path: {"./data/endpoints/$params.project/$sample/"},
            mode: 'copy',
            saveAs: { "doubletFinder" },
            overwrite: false
            ]
    }
    withName: SOUPX {
        publishDir = [
            path: {"./data/endpoints/$params.project/$sample/"},
            mode: 'copy',
            saveAs: { "soupX"},
            overwrite: false
            ]
    }
    withName: CREATE_INITIAL_SEURAT {
        publishDir = [
            path: {"./data/endpoints/$params.project/"},
            mode: 'copy',
            saveAs: { "analysis" }
            ]
    }
    withName: ANALYZE_SEURAT_OBJECT {
        ext.args = { [
            (params.cc_regression == "y") ? "--cc_method $params.cc_method" : '',
            (params.run_azimuth == "y") ? "--azimuth_ref $params.azimuth_ref" : '',
            (params.ref_based_integration == "y") ? "--ref_samples $params.ref_samples" : '',
            (params.run_transferdata == "y") ? "--transferdata_ref_file $params.transferdata_ref_file --transferdata_reduction $params.transferdata_reduction --transferdata_annocol $params.transferdata_annocol" : '',
            (params.regression_file) ? "--regression_file $params.regression_file" : '',
        ].join(' ').trim() }
        publishDir = [ 
            path: {"./data/endpoints/$params.project/"},
            mode: 'copy',
            saveAs: { "analysis" },
            overwrite: false
            ]
        publishDir = [ 
            mode: 'copy',
            path: {"./data/endpoints/$params.project/analysis/RDS/"},
            pattern: "data/endpoints/$params.project/analysis/RDS/${params.project}_analyzed_seurat_object.qs",
            saveAs: { "${params.project}_analyzed_seurat_object.qs" }
            ]
    }
    withName: CREATE_IMAGES_DGE {
        ext.args = { [
            (params.user_gene_file) ? "--user_gene_file $params.user_gene_file" : '',
        ].join(' ').trim() }
        publishDir = [ 
            path: {"./data/endpoints/$params.project/"},
            mode: 'copy',
            saveAs: { "analysis" },
            overwrite: false
            ]
        }

}